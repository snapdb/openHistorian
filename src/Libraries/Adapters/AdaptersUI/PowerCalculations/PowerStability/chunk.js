"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[363],{28363:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var l=a(6904),n=a(2580),r=a(54840),s=a(94194);const o=e=>{const[t,a]=l.useState(!0);l.useEffect((()=>{var t;0===(null===(t=e.Voltages)||void 0===t?void 0:t.length)?a(!0):a(!1)}),[e.Voltages]);const o=l.useCallback(((t,a)=>new r.GrafanaQueryFunctions(`${e.HomePath}api/Grafana`).Search({dataTypeIndex:r.Grafana.DataTypeIndex.Phasor,expression:`SELECT MagnitudePointTag, AnglePointTag FROM PhasorValues WHERE (MagnitudePointTag LIKE '%${t}%' OR AnglePointTag LIKE '%${t}%') AND Type='${a?"I":"V"}'`}).then((e=>{const t=[];return e.forEach((e=>{const[a,l]=e.split(",");t.push({Label:a,Value:a}),t.push({Label:l,Value:l})})),t}))),[e.HomePath]),i=l.useCallback((t=>{const a=e.Currents.filter(((e,a)=>a!==t)),l=e.Voltages.filter(((e,a)=>a!==t));e.SetCurrents(a.length>0?a:[""]),e.SetVoltages(l.length>0?l:[""])}),[e.Currents,e.Voltages,e.SetCurrents,e.SetVoltages]),c=l.useCallback((()=>{e.SetCurrents([...e.Currents,""]),e.SetVoltages([...e.Voltages,""])}),[e.Currents,e.Voltages,e.SetCurrents,e.SetVoltages]),u=l.useCallback(((t,a,l)=>{if("current"===a){const a=[...e.Currents];a[t]=l,e.SetCurrents(a)}else{const a=[...e.Voltages];a[t]=l,e.SetVoltages(a)}}),[e.Currents,e.Voltages,e.SetCurrents,e.SetVoltages]),d=Math.max(e.Currents.length,e.Voltages.length,1);return l.createElement(l.Fragment,null,l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12"},l.createElement(n.ToggleSwitch,{Record:{AutoMapVoltages:t},Field:"AutoMapVoltages",Setter:t=>{a(t.AutoMapVoltages),t.AutoMapVoltages&&e.SetVoltages([])},Label:"Auto Map Voltages",Help:"Flag to enable system to use Primary or Secondary Voltage associated of the Current Phasor."}))),Array.from({length:d}).map(((a,r)=>{var m,g;const p=null!==(m=e.Currents[r])&&void 0!==m?m:"",h=null!==(g=e.Voltages[r])&&void 0!==g?g:"",S=""!==p.trim()&&(t||""!==h.trim());return l.createElement("div",{className:"row align-items-center mb-2",key:r},l.createElement("div",{className:"col-5"},l.createElement(n.SearchableSelect,{Record:{Value:p},Field:"Value",Label:0===r?"Current":"",Search:e=>o(e,!0),Setter:e=>u(r,"current",e.Value),AllowCustom:!1,Style:{width:"100%"},BtnStyle:{display:"flex",paddingLeft:0,alignItems:"center"}})),l.createElement("div",{className:"col-5"},l.createElement(n.SearchableSelect,{Record:{Value:h},Field:"Value",Label:0===r?"Voltage":"",Search:e=>o(e,!1),Setter:e=>u(r,"voltage",e.Value),AllowCustom:!1,Disabled:t,Style:{width:"100%"},BtnStyle:{display:"flex",paddingLeft:0,alignItems:"center"}})),l.createElement("div",{className:"col-auto"},l.createElement("button",{className:"btn p-1",onClick:()=>i(r)},l.createElement(s.ReactIcons.TrashCan,{Color:"red"}))),r===d-1&&l.createElement("div",{className:"col-auto"},l.createElement("button",{className:"btn p-1",onClick:c,disabled:!S},l.createElement(s.ReactIcons.CirclePlus,null))))})))},i={SampleSize:{Value:15,Description:"Define the sample size, in seconds, of the data to be monitored."},EnergizedThreshold:{Value:48e3,Description:"Define the energized bus threshold, in volts. The recommended value is 20% of nominal line-to-neutral voltage."},LagTime:{Value:3,IsValid:e=>e>0,Description:"Defines the allowed past time deviation tolerance, in seconds (can be sub-second)."},LeadTime:{Value:1,IsValid:e=>e>0,Description:"Defines the allowed future time deviation tolerance, in seconds (can be sub-second)."},FramesPerSecond:{Value:30,IsValid:e=>e>0,Description:"Defines the number of frames per second expected by the adapter."},Currents:{Value:[],Description:"Defines the Current Magnitude to be used.",Parse:e=>null==e?[]:""===e?[""]:e.split(";"),Construct:e=>0===(null==e?void 0:e.length)?null:null==e?void 0:e.join(";")},Voltages:{Value:[],Description:"Defines the Voltage Magnitude to be used. If not supplied the system will use Primary or Secondary Voltage associated with the Current Phasor.",Parse:e=>null==e?[]:""===e?[""]:e.split(";"),Construct:e=>0===(null==e?void 0:e.length)?null:null==e?void 0:e.join(";")},Power:{Value:"",Description:"Defines the Output Measurement for Power Signal.",IsValid:e=>null!=e&&0!==e.trim().length},StDev:{Value:"",Description:"Defines the Output Measurement for StDev.",IsValid:e=>null!=e&&0!==e.trim().length}},c=["Power","StDev"],u={Power:"Power",StDev:"Standard Deviation"};var d=a(32098),m=a.n(d),g=a(55476),p=a(24334),h=a(28188);const S="MM/DD/YYYY HH:mm:ss.SSS",f={Currents:{Value:[],Description:"Defines the Current Magnitude to be used.",Parse:e=>null==e?[]:""===e?[""]:e.split(";"),Construct:e=>0===(null==e?void 0:e.length)?null:null==e?void 0:e.join(";")},Voltages:{Value:[],Description:"Defines the Voltage Magnitude to be used. If not supplied the system will use Primary or Secondary Voltage associated with the Current Phasor.",Parse:e=>null==e?[]:""===e?[""]:e.split(";"),Construct:e=>0===(null==e?void 0:e.length)?null:null==e?void 0:e.join(";")}},v=e=>[{refID:"A",target:`Filter PhasorValues Where ${e.map((e=>`(AnglePointTag = '${e}' OR MagnitudePointTag = '${e}')`)).join(" OR ")}`,metadataSelections:[]}],E={Settings:e=>{const t=l.useMemo((()=>r.AdapterHelperFuncs.parseConnectionString(e.ConnectionString,i)),[e.ConnectionString]);r.AdapterHelperFuncs.useSetInitialConnectionString(e.ConnectionString,e.SetConnectionString,i,t),r.AdapterHelperFuncs.useSetDefaultSettings(i,e.SetDefaultSettings);const[a,s]=l.useState(!0),d=l.useCallback((t=>{const a=r.AdapterHelperFuncs.constructConnectionString(t,i);e.SetConnectionString(a)}),[e.ConnectionString]),m=l.useCallback(((e,a)=>{const l=Object.assign(Object.assign({},t),{[a]:e});d(l)}),[t,d]),g=l.useCallback((e=>{d(Object.assign(Object.assign({},t),{Currents:e}))}),[t,d]),p=l.useCallback((e=>{d(Object.assign(Object.assign({},t),{Voltages:e}))}),[t,d]);return l.useEffect((()=>{if(null==t)return;const l=[];1===t.Voltages.length||a||l.push("At least 1 Voltage input is required."),1!==t.Currents.length&&l.push("At least 1 Current input is required."),i.Power.IsValid(t.Power)||l.push("Power Output Measurement can not be empty."),i.StDev.IsValid(t.StDev)||l.push("St Dev Output Measurement can not be empty."),i.LagTime.IsValid(t.LagTime)||l.push("Lag Time must be greater than 0."),i.LeadTime.IsValid(t.LeadTime)||l.push("Lead Time must be greater than 0."),i.FramesPerSecond.IsValid(t.FramesPerSecond)||l.push("Frames Per Second must be greater than 0."),e.SetErrors(l)}),[t,a]),null==t?l.createElement(l.Fragment,null):l.createElement("div",{className:"container-fluid d-flex flex-column h-100 p-0"},l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12"},l.createElement("fieldset",{className:"border",style:{padding:"10px"}},l.createElement("legend",{className:"w-auto pr-2",style:{fontSize:"large"}},"Inputs"),l.createElement(o,{Voltages:t.Voltages,Currents:t.Currents,SetCurrents:g,SetVoltages:p,HomePath:e.HomePath})))),l.createElement("div",{className:"row mb-3"},l.createElement("div",{className:"col-12"},l.createElement("fieldset",{className:"border",style:{padding:"10px"}},l.createElement("legend",{className:"w-auto pr-2",style:{fontSize:"large"}},"Outputs"),c.map((a=>{const s=t[a];return l.createElement("div",{className:"row mb-2 align-items-center",key:a},l.createElement("div",{className:"col-12"},l.createElement(n.SearchableSelect,{Record:{Measurement:s},Field:"Measurement",Label:u[a],Setter:e=>m(e.Measurement,a),AllowCustom:!1,Search:t=>(0,r.handleMeasurementSearch)(t,`${e.HomePath}api/grafana`),Style:{width:"100%"},BtnStyle:{display:"flex",paddingLeft:0,alignItems:"center"}})))}))))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-6"},l.createElement(n.Input,{Record:t,Setter:d,Label:"Sample Size",Type:"number",Field:"SampleSize",Valid:()=>!0,Help:i.SampleSize.Description,AllowNull:!0})),l.createElement("div",{className:"col-6"},l.createElement(n.Input,{Record:t,Setter:d,Label:"Energized Threshold",Type:"number",Field:"EnergizedThreshold",Valid:()=>!0,Help:i.EnergizedThreshold.Description,AllowNull:!0}))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 col-xl-4"},l.createElement(n.Input,{Record:t,Setter:d,Label:"Frames Per Second",Type:"number",Field:"FramesPerSecond",Valid:e=>{var a,l,n;return null===(n=null===(l=null===(a=null==i?void 0:i.FramesPerSecond)||void 0===a?void 0:a.IsValid)||void 0===l?void 0:l.call(a,t[e]))||void 0===n||n},Feedback:"Frames Per Second must be greater than 0.",Help:i.FramesPerSecond.Description,AllowNull:!0})),l.createElement("div",{className:"col-12 col-xl-4"},l.createElement(n.Input,{Record:t,Setter:d,Label:"Lag Time",Type:"number",Field:"LagTime",Valid:e=>{var a,l,n;return null===(n=null===(l=null===(a=i.LagTime)||void 0===a?void 0:a.IsValid)||void 0===l?void 0:l.call(a,t[e]))||void 0===n||n},Feedback:"Lag Time must be greater than 0.",Help:i.LagTime.Description,AllowNull:!0})),l.createElement("div",{className:"col-12 col-xl-4"},l.createElement(n.Input,{Record:t,Setter:d,Label:"Lead Time",Type:"number",Field:"LeadTime",Valid:e=>{var a,l,n;return null===(n=null===(l=null===(a=i.LeadTime)||void 0===a?void 0:a.IsValid)||void 0===l?void 0:l.call(a,t[e]))||void 0===n||n},Feedback:"Lead Time must be greater than 0.",Help:i.LeadTime.Description,AllowNull:!0}))))},Input:e=>{const t=`${e.HomePath}api/grafana`,a=l.useRef(null),{width:n}=(0,p.useGetContainerPosition)(a),o=(0,r.useGetLegendWidth)(n),{Currents:i,Voltages:c}=l.useMemo((()=>r.AdapterHelperFuncs.parseConnectionString(e.ConnectionString,f)),[e.ConnectionString]),[u,d]=l.useState({start:m().utc().subtract(e.Settings.DefaultDuration,"seconds").format(S).toString(),end:m().utc().format(S).toString()}),E=l.useMemo((()=>v(null!=i?i:[])),[i]),C=l.useMemo((()=>v(null!=c?c:[])),[c]),{Data:V,Status:b}=(0,r.useGrafanaQuery)(E,m().utc(u.start).toISOString(),m().utc(u.end).toISOString(),t,r.Grafana.DataTypeIndex.Phasor),{Data:y,Status:D}=(0,r.useGrafanaQuery)(C,m().utc(u.start).toISOString(),m().utc(u.end).toISOString(),t,r.Grafana.DataTypeIndex.Phasor),[T,w]=l.useState(0);return l.useEffect((()=>{const e=[...y,...V],t=setInterval((()=>{w((t=>{if(0===e.length||0===e[0].datapoints.length)return t;const a=Math.min(...e.map((e=>e.datapoints.length)));return 0===a?0:(t+1)%a}))}),5e3);return()=>clearInterval(t)}),[y,V]),l.createElement(l.Fragment,null,l.createElement("div",{className:"container-fluid d-flex flex-column h-100 p-0"},l.createElement("div",{className:"row m-0 pb-3"},l.createElement("div",{className:"col-12 p-0"},l.createElement(g.TimeFilter,{filter:u,setFilter:(e,t)=>d({start:e,end:t}),showQuickSelect:!0,isHorizontal:!0,dateTimeSetting:e.Settings.DateTimeSetting,timeZone:"UTC",format:"datetime-local",accuracy:"millisecond",showHelpMessage:!1}))),"loading"===b||"loading"===D?l.createElement("div",{className:"row m-0"},l.createElement("div",{className:"col-12 p-0 d-flex flex-column align-items-center justify-content-center"},l.createElement(s.ReactIcons.SpiningIcon,{Size:200}))):l.createElement(l.Fragment,null,l.createElement("div",{className:"row m-0"},l.createElement("div",{className:"col-9 p-0",ref:a},l.createElement(h.Kl,{defaultTdomain:[m().utc(u.start,S).valueOf(),m().utc(u.end,S).valueOf()],height:200,width:n,Ylabel:"Voltage (Mag)",legend:"right",yDomain:"AutoValue",Tlabel:"Time",useMetricFactors:!1,legendWidth:o,showDateOnTimeAxis:!0},y.map(((e,t)=>l.createElement(h.N1,{key:t,data:e.datapoints.map((e=>[e[2],e[0]])),color:(0,r.getColor)(t),lineStyle:"-",legend:e.target}))))),l.createElement("div",{className:"col-3 p-0 d-flex justify-content-center align-items-center"},l.createElement("svg",{width:"140",height:"140",viewBox:"0 0 140 140",style:{display:"block",marginTop:"8px"}},l.createElement("circle",{style:{fill:"none",stroke:"currentColor"},cx:70,cy:70,r:65}),l.createElement("circle",{style:{fill:"none",stroke:"currentColor"},cx:70,cy:70,r:35}),l.createElement("line",{style:{stroke:"currentColor"},x1:70,y1:0,x2:70,y2:140}),l.createElement("line",{style:{stroke:"currentColor"},x1:0,y1:70,x2:140,y2:70}),l.createElement("g",null,y.map(((e,t)=>0!==e.datapoints.length&&l.createElement("path",{key:t,style:{fill:(0,r.getColor)(t),stroke:(0,r.getColor)(t)},d:"M 70 70 L 70 0 L 65 10 L 75 10 L 70 0",transform:`rotate(${e.datapoints[0][1]} 70 70)`}))))))),l.createElement("div",{className:"row m-0"},l.createElement("div",{className:"col-9 p-0"},l.createElement(h.Kl,{defaultTdomain:[m().utc(u.start,S).valueOf(),m().utc(u.end,S).valueOf()],height:250,width:n,Ylabel:"Current (Mag)",legend:"right",yDomain:"AutoValue",Tlabel:"Time",useMetricFactors:!1,legendWidth:o,showDateOnTimeAxis:!0},V.map(((e,t)=>l.createElement(h.N1,{key:t,data:e.datapoints.map((e=>[e[2],e[0]])),color:(0,r.getColor)(t),lineStyle:"-",legend:e.target}))))),l.createElement("div",{className:"col-3 p-0 d-flex justify-content-center align-items-center"},l.createElement("svg",{width:"140",height:"140",viewBox:"0 0 140 140",style:{display:"block",marginTop:"8px"}},l.createElement("circle",{style:{fill:"none",stroke:"currentColor"},cx:70,cy:70,r:65}),l.createElement("circle",{style:{fill:"none",stroke:"currentColor"},cx:70,cy:70,r:35}),l.createElement("line",{style:{stroke:"currentColor"},x1:70,y1:0,x2:70,y2:140}),l.createElement("line",{style:{stroke:"currentColor"},x1:0,y1:70,x2:140,y2:70}),l.createElement("g",null,V.map(((e,t)=>0!==e.datapoints.length&&l.createElement("path",{key:t,style:{fill:(0,r.getColor)(t),stroke:(0,r.getColor)(t)},d:"M 70 70 L 70 0 L 65 10 L 75 10 L 70 0",transform:`rotate(${e.datapoints[T][1]} 70 70)`}))))))))))},Output:e=>{const{Power:t,StDev:a}=r.AdapterHelperFuncs.parseConnectionString(e.ConnectionString),n=[t,a].filter((e=>null!=e&&""!==e)).join("; ");return l.createElement(r.DefaultAdapterOutput,Object.assign({},e,{Outputs:n}))}}}}]);