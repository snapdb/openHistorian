"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[606],{25606:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var a=n(6904),s=n(2580),r=n(54840),l=function(e,t,n,a){return new(n||(n=Promise))((function(s,r){function l(e){try{u(a.next(e))}catch(e){r(e)}}function i(e){try{u(a.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}u((a=a.apply(e,t||[])).next())}))};const i={LagTime:{Value:3,IsValid:e=>e>0,Description:"Defines the allowed past time deviation tolerance, in seconds (can be sub-second)."},LeadTime:{Value:1,IsValid:e=>e>0,Description:"Defines the allowed future time deviation tolerance, in seconds (can be sub-second)."},FramesPerSecond:{Value:30,IsValid:e=>e>0,Description:"Defines the number of frames per second expected by the adapter."},InputMeasurementKeys:{Value:[],Description:"Defines primary keys of input measurements the action adapter expects; can be one of a filter expression, measurement key, point tag or Guid.",Parse:e=>null==e?[]:""===e?[""]:e.split(";"),Construct:e=>0===(null==e?void 0:e.length)?null:null==e?void 0:e.join(";")},OutputMeasurements:{Value:"",Description:"Defines output measurement for the calculated reference angle."}},u="IPHA",o="VPHA",c=(e,t)=>l(void 0,void 0,void 0,(function*(){const n=`${t}api/grafana`,a=e.map((e=>`PointTag = '${e.trim()}'`)).join(" OR "),s=new r.GrafanaQueryFunctions(n);try{const e=yield s.Search({expression:`Select SignalType from ActiveMeasurements Where ${a}`,dataTypeIndex:r.Grafana.DataTypeIndex.Measurement}),t=e.every((e=>e===u)),n=e.every((e=>e===o));if(t)return u;if(n)return o;throw"All input measurements must be either current phase angles OR voltage phase angles."}catch(e){throw"All input measurements must be either current phase angles OR voltage phase angles."}})),m={Settings:e=>{var t;const n=a.useMemo((()=>r.AdapterHelperFuncs.parseConnectionString(e.ConnectionString,i)),[e.ConnectionString]);r.AdapterHelperFuncs.useSetInitialConnectionString(e.ConnectionString,e.SetConnectionString,i,n),r.AdapterHelperFuncs.useSetDefaultSettings(i,e.SetDefaultSettings);const[m,d]=a.useState(!0),p=a.useCallback((t=>{const n=r.AdapterHelperFuncs.constructConnectionString(t,i);e.SetConnectionString(n)}),[e.ConnectionString]);a.useEffect((()=>{null!=(null==n?void 0:n.InputMeasurementKeys)&&l(void 0,void 0,void 0,(function*(){try{const t=yield c(n.InputMeasurementKeys,e.HomePath);d(t===u)}catch(e){}}))}),[n.InputMeasurementKeys,e.HomePath]);const g=a.useCallback((e=>{p(Object.assign(Object.assign({},n),{InputMeasurementKeys:e}))}),[n,p]),v=a.useCallback((t=>l(void 0,void 0,void 0,(function*(){var a;if(d(t),null!=(null===(a=n.InputMeasurementKeys)||void 0===a?void 0:a.length))try{const a=n.InputMeasurementKeys.map((e=>`'${e.trim()}'`)).join(","),s=`\n                SELECT PointTag \n                FROM ActiveMeasurements \n                WHERE SignalType='${t?u:o}'\n                AND PointTag IN (${a})\n            `,l=new r.GrafanaQueryFunctions(`${e.HomePath}api/grafana`),i=yield l.Search({expression:s,dataTypeIndex:r.Grafana.DataTypeIndex.Measurement});p(Object.assign(Object.assign({},n),{InputMeasurementKeys:i}))}catch(e){}}))),[n,e.HomePath,p]);return a.useEffect((()=>{null!=n&&l(void 0,void 0,void 0,(function*(){const t=[];if(n.InputMeasurementKeys.length>1)try{const a=yield c(n.InputMeasurementKeys,e.HomePath);a!==u&&a!==o&&t.push("All input measurements must be either all current phase angles or all voltage phase angles.")}catch(e){t.push("All input measurements must be either all current phase angles or all voltage phase angles.")}else n.InputMeasurementKeys,length<2&&t.push("At least two input measurements are required.");i.LagTime.IsValid(n.LagTime)||t.push("Lag Time must be greater than 0."),i.LeadTime.IsValid(n.LeadTime)||t.push("Lead Time must be greater than 0."),i.FramesPerSecond.IsValid(n.FramesPerSecond)||t.push("Frames Per Second must be greater than 0."),e.SetErrors(t)}))}),[n]),null==n?a.createElement(a.Fragment,null):a.createElement("div",{className:"container-fluid d-flex flex-column h-100 p-0"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-12"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col-12"},a.createElement(r.MeasurementSelector,{Measurements:n.InputMeasurementKeys,SetMeasurements:g,HomePath:e.HomePath,Title:"Inputs",DataTypeIndex:r.Grafana.DataTypeIndex.Measurement,BuildSearchExpression:e=>`SELECT PointTag FROM ActiveMeasurements Where SignalType = '${m?u:o}' AND PointTag Like '%${e}%'`,AdditionalUI:a.createElement(s.ToggleSwitch,{Record:{UseCurrents:m},Field:"UseCurrents",Setter:e=>v(e.UseCurrents),Label:"Use Currents",Help:"Flag to enable using currents as input measurements."})}))))),a.createElement("div",{className:"row mb-3"},a.createElement("div",{className:"col-12"},a.createElement("fieldset",{className:"border",style:{padding:"10px"}},a.createElement("legend",{className:"w-auto pr-2",style:{fontSize:"large"}},"Outputs"),a.createElement("div",{className:"row mb-2 align-items-center"},a.createElement("div",{className:"col-12"},a.createElement(s.SearchableSelect,{Record:{Measurement:null!==(t=null==n?void 0:n.OutputMeasurements)&&void 0!==t?t:""},Field:"Measurement",Label:"Reference Angle",Setter:e=>p(Object.assign(Object.assign({},n),{OutputMeasurements:e.Measurement})),AllowCustom:!1,Search:t=>(0,r.handleMeasurementSearch)(t,`${e.HomePath}api/grafana`),Style:{width:"100%"},BtnStyle:{display:"flex",paddingLeft:0,alignItems:"center"}})))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col-12 col-xl-4"},a.createElement(s.Input,{Record:n,Setter:p,Label:"Frames Per Second",Type:"number",Field:"FramesPerSecond",Valid:e=>{var t,a,s;return null===(s=null===(a=null===(t=null==i?void 0:i.FramesPerSecond)||void 0===t?void 0:t.IsValid)||void 0===a?void 0:a.call(t,n[e]))||void 0===s||s},Feedback:"Frames Per Second must be greater than 0.",Help:i.FramesPerSecond.Description,AllowNull:!0})),a.createElement("div",{className:"col-12 col-xl-4"},a.createElement(s.Input,{Record:n,Setter:p,Label:"Lag Time",Type:"number",Field:"LagTime",Valid:e=>{var t,a,s;return null===(s=null===(a=null===(t=i.LagTime)||void 0===t?void 0:t.IsValid)||void 0===a?void 0:a.call(t,n[e]))||void 0===s||s},Feedback:"Lag Time must be greater than 0.",Help:i.LagTime.Description,AllowNull:!0})),a.createElement("div",{className:"col-12 col-xl-4"},a.createElement(s.Input,{Record:n,Setter:p,Label:"Lead Time",Type:"number",Field:"LeadTime",Valid:e=>{var t,a,s;return null===(s=null===(a=null===(t=i.LeadTime)||void 0===t?void 0:t.IsValid)||void 0===a?void 0:a.call(t,n[e]))||void 0===s||s},Feedback:"Lead Time must be greater than 0.",Help:i.LeadTime.Description,AllowNull:!0}))))},Input:null,Output:null}}}]);